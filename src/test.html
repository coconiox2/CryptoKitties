<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>test</title>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->

<script src="js/jsbn/jsbn.js"></script>
<script src="js/jsbn/jsbn2.js"></script>
<script src="js/jsbn/prng4.js"></script>
<script src="js/jsbn/rng.js"></script>
<script src="js/paillier.js"></script>

<script src="js/papaparse.js"></script>
<script src="js/jschardet.js"></script>
<script src="js/base64.js"></script>

<script type="text/javascript">

function lcm(a,b) {
  return a.multiply(b).divide(a.gcd(b));
}

function gmod(a,b){
	if(a.compareTo(BigInteger.ONE) == 0){
		return BigInteger.ONE;
	}

	if((a.mod(b)).compareTo(BigInteger.ZERO) == 0){
		return BigInteger.ZERO;
	}

	while(b.mod(a).compareTo(BigInteger.ZERO) != 0){

	}
}

function imRsaGenKey(numBits){
	var p,q,r,s;
	var rng = new SecureRandom();
	var n;
	var e,d;
	var y;
	do {
			do {
				p = new BigInteger(numBits>>1,1,rng);
			} while (!p.isProbablePrime(10));

			do {
				q = new BigInteger(numBits>>1,1,rng);
			} while(!q.isProbablePrime(10));

			do {
				r = new BigInteger(numBits>>1,1,rng);
			} while(!r.isProbablePrime(10));

			do {
				s = new BigInteger(numBits>>1,1,rng);
			} while(!s.isProbablePrime(10));

			n = p.multiply(q).multiply(r).multiply(s);
	} while(!(n.testBit(numBits - 1)) || (p.compareTo(q) == 0) ||
		(p.compareTo(r) == 0) || (p.compareTo(s) == 0) || (q.compareTo(r) == 0)||
		(q.compareTo(s) == 0) || (r.compareTo(s) == 0));
	var oula = p.subtract(BigInteger.ONE).multiply(q.subtract(BigInteger.ONE)).multiply(r.subtract(BigInteger.ONE)).multiply(s.subtract(BigInteger.ONE));
	
	do{
		e = new BigInteger(numBits,rng);
	}while((e.compareTo(oula) >= 0) || (e.compareTo(BigInteger.ONE) <= 0) || (e.gcd(oula) != 1));
	///////(e,n)为公钥
	///////(d,n)是私钥

	do{
		d = e.modInverse(oula);
	}while((d.compareTo(oula) >= 0) || (d.compareTo(BigInteger.ZERO) <=0) );

	
	if(p.compareTo(q) > 0){
		var n_p = n.subtract(p);
		do{
			var ran = Math.floor(Math.random()*100);
			var ranBig = new BigInteger(ran.toString(10));
			var y = n_p.add(ranBig);
		}while((y.compareTo(n) >= 0) || (y.gcd(n) != 1));
	}else{
		var n_q = n.subtract(q);
		do{
			var ran = Math.floor(Math.random()*100);
			var ranBig = new BigInteger(ran.toString(10));
			var y = n_q.add(ranBig);
		}while((y.compareTo(n) >= 0) || (y.gcd(n) != 1));
	}


	var keys = new Array();
	keys[0] = y;
	keys[1] = e;
	keys[2] = d;
	return keys.join(" ");;
	
}

function rsaGenKey(numBits){
	var p,q;
	var rng = new SecureRandom();
	var n;
	var e,d;
	do {
			do {
				p = new BigInteger(numBits>>1,1,rng);
			} while (!p.isProbablePrime(10));

			do {
				q = new BigInteger(numBits>>1,1,rng);
			} while(!q.isProbablePrime(10));

			n = p.multiply(q);
	} while(!(n.testBit(numBits - 1)) || (p.compareTo(q) == 0));
	var oula = lcm(p.subtract(BigInteger.ONE),q.subtract(BigInteger.ONE));
	do{
		e = new BigInteger(numBits,rng);
	}while((e.compareTo(oula) >= 0) || (e.compareTo(BigInteger.ONE) <= 0) || (e.gcd(oula) != 1));
	///////(e,n)为公钥
	///////(d,n)是私钥
	do{
		d = e.modInverse(oula);
	}while((d.compareTo(oula) >= 0) || (d.compareTo(BigInteger.ZERO) <=0) );

	var keys = new Array();
	keys[0] = n;
	keys[1] = e;
	keys[2] = d;
	return keys.join(" ");;
	
}

function rsaEn(_fileContent,_pubKey){
	//////_fileContent是字符串,处理时需要先以此字符串为基础新建一个biginteger，
	////// 处理结束后用tostring（10）返回
	//////_pubKey是字符串 "n e"
	var keys = new Array();
	keys = _pubKey.split(" ");
	var n = new BigInteger(keys[0]);
	var e = new BigInteger(keys[1]);
	var m = new BigInteger(_fileContent);
	return m.modPow(e,n).toString(10);
}

function rsaDe(_fileContent,_priKey){
	//////_fileContent是字符串,处理时需要先以此字符串为基础新建一个biginteger，
	////// 处理结束后用tostring（10）返回
	//////_pubKey是字符串 "n d"
	var keys = new Array();
	keys = _priKey.split(" ");
	var n = new BigInteger(keys[0]);
	var d = new BigInteger(keys[1]);
	var c = new BigInteger(_fileContent);
	return c.modPow(d,n).toString(10);
}
imRsaGenKey(256);
/*
var keys = imRsaGenKey(256);
var key = keys.split(" ");
var pubkey = new Array();
var prikey = new Array();
pubkey[0] = key[0];
pubkey[1] = key[1];

prikey[0] = key[0];
prikey[1] = key[2];

var en = rsaEn("213",pubkey.join(" "));
var de = rsaDe(en,prikey.join(" ")); 

console.log(de);
*/
</script>
</head>
<body>
</body>
</html>
